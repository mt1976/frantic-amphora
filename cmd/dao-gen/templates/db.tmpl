// Data Access Object for the {{.TableName}} table
// Template Version: 0.5.23 - 2026-01-28
// Generated 
// Date: {{.GeneratedDate}}
// Who : {{.GeneratedBy}}

package {{.PackageName}}

import (
	"context"

	"github.com/mt1976/frantic-amphora/dao/database"
	"github.com/mt1976/frantic-core/commonConfig"
	"github.com/mt1976/frantic-core/logHandler"
	"github.com/mt1976/frantic-core/timing"
)

var activeDBConnection *database.DB
var databaseConnectionActive bool
var cfg *commonConfig.Settings

// Initialise opens the database connection for {{.TypeName}} and optionally enables caching.
func Initialise(ctx context.Context, cached bool) {
	//logHandler.DatabaseLogger.Printf("Opening connection to %v", tableName)
	logHandler.TraceLogger.Printf("Initialising %v DAO Caching: %t", tableName, cached)

	clock := timing.Start(tableName, "Initialise", "Initialise")
	cfg = commonConfig.Get()
	_ = cfg

	activeDBConnection = database.Connect({{.TypeName}}{}, database.WithVerbose(false), database.WithCaching(cached), database.WithCacheKey({{.FieldsVar}}.Key), database.WithNameSpace("{{.Namespace}}"))
	databaseConnectionActive = true

	clock.Stop(1)
	//logHandler.DatabaseLogger.Printf("Opened connection to %v", tableName)
}

// IsInitialised reports whether the DAO has an active database connection.
func IsInitialised() bool {
	return databaseConnectionActive
}

// GetDatabaseConnections returns a function that supplies the database connections used by this DAO.
func GetDatabaseConnections() func() ([]*database.DB, error) {
	return func() ([]*database.DB, error) {
		return []*database.DB{activeDBConnection}, nil
	}
}
